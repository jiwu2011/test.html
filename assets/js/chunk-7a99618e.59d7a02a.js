(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7a99618e"],{"13d5":function(e,t,a){"use strict";var i=a("23e7"),r=a("d58f").left,o=a("a640"),l=a("ae40"),n=a("2d00"),s=a("605d"),d=o("reduce"),c=l("reduce",{1:0}),u=!s&&n>79&&n<83;i({target:"Array",proto:!0,forced:!d||!c||u},{reduce:function(e){return r(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},6341:function(e,t,a){},"668a":function(e,t,a){"use strict";a("6341")},"821f":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{attrs:{visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("template",{slot:"title"},[a("div",{staticStyle:{"font-size":"14px",color:"blue","font-weight":"bold"}},[e._v("监控地图修编")])]),a("el-tabs",{staticStyle:{margin:"0",padding:"0"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{name:"first"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-date"}),e._v(" 基本信息 ")]),a("el-form",{attrs:{model:e.form}},[a("el-row",[a("el-col",{attrs:{span:24,offset:0}},[a("el-row",{attrs:{gutter:40}},[a("el-col",{attrs:{span:12}},[a("el-form",{attrs:{"label-width":"70px"}},[a("el-form-item",{attrs:{label:"所属图层"}},[a("el-cascader",{attrs:{placeholder:"所属图层",options:e.layers,props:{label:"name",value:"id",children:"children",checkStrictly:!0,emitPath:!1},filterable:""},model:{value:e.form.layerID,callback:function(t){e.$set(e.form,"layerID",t)},expression:"form.layerID"}})],1)],1)],1)],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:24,offset:0}},[a("el-row",{attrs:{gutter:40}},[a("el-col",{attrs:{span:12}},[a("el-form",{attrs:{"label-width":"70px"}},[a("el-form-item",{attrs:{label:"地理经度"}},[a("el-input",{attrs:{placeholder:"请输入地理纬度"},model:{value:e.form.longitude,callback:function(t){e.$set(e.form,"longitude",t)},expression:"form.longitude"}})],1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form",{attrs:{"label-width":"70px"}},[a("el-form-item",{attrs:{label:"地理纬度"}},[a("el-input",{attrs:{placeholder:"请输入地理纬度"},model:{value:e.form.latitude,callback:function(t){e.$set(e.form,"latitude",t)},expression:"form.latitude"}})],1)],1)],1)],1)],1)],1)],1)],1),a("el-tab-pane",{attrs:{name:"second"}},[a("span",{attrs:{slot:"label"},slot:"label"},[a("i",{staticClass:"el-icon-date"}),e._v(" 地图标绘 ")]),a("my-map",{attrs:{gisInfo:e.eventGis},on:{marked:e.handMarked}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.saveGIS}},[e._v("确 定")])],1)],2),a("div",{staticClass:"search"},[a("el-row",[a("el-col",{attrs:{span:24,offset:0}},[a("el-row",{attrs:{gutter:40}},[a("el-col",{attrs:{span:7}},[a("el-form",{attrs:{"label-width":"100px"}},[a("el-form-item",{attrs:{label:"监控点名称"}},[a("el-input",{attrs:{placeholder:"请输入搜索内容"},model:{value:e.pars.videoName,callback:function(t){e.$set(e.pars,"videoName",t)},expression:"pars.videoName"}})],1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-form",{attrs:{"label-width":"40px"}},[a("el-form-item",{attrs:{label:"状态"}},[a("el-select",{attrs:{placeholder:"请选择在线状态"},model:{value:e.pars.status,callback:function(t){e.$set(e.pars,"status",t)},expression:"pars.status"}},e._l(e.onLines,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),a("el-col",{attrs:{span:6}},[a("el-button",{attrs:{type:"primary"},on:{click:e.handSearch}},[e._v("搜索")])],1)],1)],1)],1)],1),a("div",{staticClass:"content"},[a("el-table",{staticStyle:{width:"100%"},attrs:{"highlight-current-row":!0,border:!0,stripe:!0,"header-cell-style":{background:"#66b1ff",color:"#fff",border:"1px solid #fff"},data:e.tableData}},[a("el-table-column",{attrs:{type:"selection",width:"35"}}),a("el-table-column",{attrs:{prop:"videoName",label:"监控点名称",width:"150"}}),a("el-table-column",{attrs:{prop:"videoTypeName",label:"分组",width:"160"}}),a("el-table-column",{attrs:{prop:"status",label:"状态",width:"70"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:2==t.row.status?"success":1==t.row.status?"danger":3==t.row.status?"info":"warning"}},[e._v(e._s(2==t.row.status?"在线":"离线"))])]}}])}),a("el-table-column",{attrs:{label:"操作",width:"280"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-video-play",size:"mini"},on:{click:function(a){return e.HlsAddr(t.row)}}},[e._v("播放")]),a("el-button",{attrs:{icon:"el-icon-location",size:"mini"},on:{click:function(a){return e.handPoint(t.row)}}},[e._v("修正")]),a("el-button",{attrs:{icon:"el-icon-location",size:"mini"},on:{click:function(a){return e.handAddPlay(t.row)}}},[e._v("群组")])]}}])})],1),a("el-pagination",{staticStyle:{"margin-top":"5px"},attrs:{background:"",layout:"total,prev, pager, next",total:e.total,"current-page":e.pars.pageIndex,"page-size":e.pars.pageSize},on:{"current-change":e.handPageIndexChanged}})],1),a("div",{staticClass:"right"},[a("div",{staticClass:"video"},[a("video",{ref:"video",staticStyle:{height:"200px",width:"98%",background:"black"},attrs:{controls:""}})]),a("div",{staticClass:"tree"},[a("el-input",{attrs:{placeholder:"输入关键字进行过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),a("el-tree",{ref:"tree",attrs:{data:e.data,id:"el-tree",props:e.defaultProps,"filter-node-method":e.filterNode,"show-checkbox":!0},on:{"check-change":e.getCheckedNodes,"node-click":e.handleNodeClick}})],1),a("div",{staticClass:"map",attrs:{id:"map"},on:{contextmenu:function(t){return t.preventDefault(),e.clearPoint(t)}}})])],1)},r=[],o=(a("4de4"),a("d81d"),a("13d5"),a("ac1f"),a("1276"),a("7c15")),l=a("de9b"),n=a("600f"),s=a("ba56"),d={data:function(){return{eventGis:{longitude:113.07329268615261,latitude:28.255592768842703,layerID:0,featureid:void 0},gis:{longitude:113.07329268615261,latitude:28.255592768842703,layerID:0,featureid:void 0},search_addr:void 0,dialogFormVisible:!1,activeName:"first",formLabelWidth:"80px",map:void 0,layers:[],nodeData:{},onLines:[{label:"所有状态",value:0},{label:"在线",value:2},{label:"离线",value:1}],filterText:"",total:0,data:[],defaultProps:{children:"children",label:"codeName"},treePars:{codeType:9,pageSize:1e3},pars:{pageSize:10,pageIndex:1,status:void 0,videoName:void 0,videoType:void 0},playPars:{cameraIndexCode:void 0,videoType:void 0,cameracode:void 0,count:0,src:void 0},form:{videoID:void 0,layerID:5,longitude:void 0,latitude:void 0,label:void 0,videoCodeIndex:void 0},tableData:[],treeData:[]}},components:{"my-map":l["a"]},methods:{handMarked:function(e,t){this.form.longitude=e,this.form.latitude=t},videoPause:function(){this.hls&&(this.$refs.video.pause(),this.hls.destroy(),this.hls=null)},selectPoint:function(){var e;n["a"].set_map_operation_mode(this.map,2,e).then((function(e){console.log(e)}))},handDraw:function(){n["a"].delete_draw(this.map,"search"),n["a"].delete_draw(this.map,"center"),n["a"].delete_draw(this.map,"range"),n["a"].delete_draw(this.map,"center"),n["a"].delete_layer_features(this.map,[]),n["a"].add_one_layer_featurelist(this.map,3,[]),n["a"].draw_search(1,this.map,[3]).then((function(e){console.log("draw_search"),console.log(e),console.log("draw_search")}))},searchMap:function(){var e=this;if(n["a"].delete_draw(this.map,"search"),n["a"].delete_draw(this.map,"center"),""!=this.search_addr){var t=0,a=0;n["a"].local_search(this.map.getLayers().getArray()[0],this.search_addr,!1).then((function(i){if(i.length>0){var r=i[0].location,o=r.split(","),l=n["a"].gaode_gcs(o);l&&2==l.length&&(t=l[0],a=l[1],console.log(t),console.log(a),n["a"].center_display(parseFloat(t),parseFloat(a),200,e.map))}}))}},HlsAddr:function(e){var t=this;this.playPars.cameraIndexCode=e.videoCodeIndex,this.playPars.cameracode=e.videoCodeIndex,this.playPars.videoType=e.videoType,this.playPars.count=0,Object(o["db"])({cameracode:e.videoCodeIndex,media:1}).then((function(e){t.playPars.src=e.data.rtsp,t.getStream(t.playPars.src),console.log(t.playPars.src),console.log(e)}))},initMap:function(){var e=this;setTimeout((function(){if(void 0!=e.map)return n["a"].delete_draw(e.map,"search"),n["a"].delete_draw(e.map,"center"),n["a"].center_display(113.22431300139478,28.344509054401712,2e4,e.map),void n["a"].delete_draw(e.map,"center");e.map=n["a"].set_map("locationMap",!0,!0,!0,!0,!0),n["a"].add_baselayers(e.map),n["a"].add_all_features(e.map),n["a"].add_one_layer_featurelist(e.map,parseInt(e.form.layerID),[]),n["a"].open_levels(!1,e.map)}),200)},handleClick:function(e,t){"second"==this.activeName&&(this.eventGis.longitude=this.gis.longitude,this.eventGis.latitude=this.gis.latitude,this.eventGis.layerID=this.gis.layerID=this.form.layerID)},GetHls:function(){var e=this;this.playPars.count++,this.playPars.count>3||Object(o["ib"])(JSON.stringify(this.playPars)).then((function(t){e.getStream(t.data),console.log(t)}))},clearPoint:function(){n["a"].delete_feature(this.map)},handGetMapLayer:function(){var e=this,t={type:"point"};Object(o["ac"])(t).then((function(t){var a=t.data,i=a.reduce((function(e,t){return e[t.id]=t,t.children=[],e}),{}),r=a.filter((function(e){return i[e.fid]&&i[e.fid].children.push(e),0==e.fid}));e.layers=r,console.log(r)}))},handAddPlay:function(e){var t=this,a={videoCodeIndex:e.videoCodeIndex,videoName:e.videoName,videoTypeName:e.videoTypeName,videoType:e.videoType};console.log(a),Object(o["a"])(a).then((function(e){console.log(e),t.$message({message:"成功将视频监控加入播放队列!",type:"success"})}))},handPoint:function(e){this.dialogFormVisible=!0,this.form.latitude=e.latitude,this.form.longitude=e.longitude,this.form.layerID=e.layerID,this.form.label=e.videoName,this.form.videoCodeIndex=e.videoCodeIndex},handMapPoint:function(){var e=this;n["a"].add_point(this.map,999,999).then((function(t){e.form.longitude=t[0],e.form.latitude=t[1],e.$message({message:"("+t[0]+","+t[1]+")",type:"success"})}))},saveGIS:function(){var e=this,t={layercode:parseInt(this.form.layerID),latitude:parseFloat(this.form.latitude),longitude:parseFloat(this.form.longitude),featureid:this.form.videoCodeIndex,label:this.form.label,minzoom:0};Object(o["wb"])(t).then((function(a){console.log("gis"),console.log(t),console.log(a),console.log("gis"),e.dialogFormVisible=!1}))},getStream:function(e){if(s.isSupported()){this.videoPause(),this.hls=new s({autoStartLoad:!0,manifestLoadingTimeOut:6e4,manifestLoadingRetryDelay:500,levelLoadingTimeOut:6e4,levelLoadingRetryDelay:500,liveSyncDurationCount:1,fragLoadingTimeOut:6e4,fragLoadingRetryDelay:250,startFragPrefetch:!0}),this.hls.loadSource(e),this.hls.attachMedia(this.$refs.video);var t=this.hls,a=this.$refs.video;t.on(s.Events.MANIFEST_PARSED,(function(t,i){console.log("manifest loaded, found "+i.levels.length+" quality level",e),a.play()})),this.hls.on(s.Events.ERROR,(function(a,i){if(console.log(i),i.fatal)switch(i.type){case s.ErrorTypes.NETWORK_ERROR:console.log("fatal network error encountered, try to recover",e),i.details===s.ErrorDetails.MANIFEST_LOAD_ERROR||i.details===s.ErrorDetails.MANIFEST_LOAD_TIMEOUT||i.details===s.ErrorDetails.MANIFEST_PARSING_ERROR?t.loadSource(e):t.startLoad();break;case s.ErrorTypes.MEDIA_ERROR:console.log("fatal media error encountered, try to recover",e),t.recoverMediaError();break;default:console.log("destroy"),this.$message({message:"取流失败",type:"error"});break}}))}},beforeDestroy:function(){this.videoPause()},getKinds:function(){var e=this;Object(o["c"])(this.treePars).then((function(t){var a=t.data,i=a.reduce((function(e,t){return e[t.codeValue]=t,t.children=[],e}),{}),r=a.filter((function(e){return i[e.parentID]&&i[e.parentID].children.push(e),"-1"==e.parentID}));e.data=r}))},handSearch:function(){this.getVideoList()},handPageIndexChanged:function(e){this.pars.pageIndex=e,this.getVideoList()},filterNode:function(){},getCheckedNodes:function(){this.pars.videoType=void 0;var e=[];this.$refs.tree.getCheckedNodes().map((function(t,a){return e.push(t.codeValue),void 0===t}));e.length>0&&(this.pars.videoType=e),console.log(this.pars),this.getVideoList()},handleNodeClick:function(){},getVideoList:function(){var e=this;Object(o["Ib"])(this.pars).then((function(t){e.tableData=t.data,e.total=t.total,console.log(e.tableData)}))}},mounted:function(){this.getVideoList(),this.getKinds(),this.handGetMapLayer()}},c=d,u=(a("668a"),a("2877")),h=Object(u["a"])(c,i,r,!1,null,"2fc17ba1",null);t["default"]=h.exports},"8add":function(e,t,a){},b205:function(e,t,a){"use strict";a("8add")},b85c:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));a("a4d3"),a("e01a"),a("d28b"),a("d3b7"),a("3ca3"),a("ddb0");var i=a("06c5");function r(e,t){var a;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=Object(i["a"])(e))||t&&e&&"number"===typeof e.length){a&&(e=a);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,n=!0,s=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return n=e.done,e},e:function(e){s=!0,l=e},f:function(){try{n||null==a["return"]||a["return"]()}finally{if(s)throw l}}}}},d58f:function(e,t,a){var i=a("1c0b"),r=a("7b0b"),o=a("44ad"),l=a("50c4"),n=function(e){return function(t,a,n,s){i(a);var d=r(t),c=o(d),u=l(d.length),h=e?u-1:0,p=e?-1:1;if(n<2)while(1){if(h in c){s=c[h],h+=p;break}if(h+=p,e?h<0:u<=h)throw TypeError("Reduce of empty array with no initial value")}for(;e?h>=0:u>h;h+=p)h in c&&(s=a(s,c[h],h,d));return s}};e.exports={left:n(!1),right:n(!0)}},de9b:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{height:"50vh"}},[a("el-scrollbar",{staticStyle:{height:"100%"}},[a("div",{attrs:{id:"all"}},[a("div",{staticClass:"searchMap"},[a("el-autocomplete",{staticClass:"input-with",staticStyle:{width:"300px"},attrs:{id:"search-input",placeholder:"请输入地址",size:"mini","fetch-suggestions":e.querySearchAsync},on:{change:e.loadSearchResult,select:e.handleAddrSelect},model:{value:e.search_addr,callback:function(t){e.search_addr=t},expression:"search_addr"}}),a("el-button",{staticStyle:{border:"1px"},on:{click:e.handPoint}},[e._v("标记")])],1),a("div",{ref:"map",staticClass:"map",attrs:{id:"commonMap"}})])])],1)},r=[],o=(a("c975"),a("d81d"),a("b0c0"),a("ac1f"),a("1276"),a("b85c")),l=a("600f"),n={data:function(){return{search_addr:"",longitude:0,latitude:0,layerID:999,map:void 0,label:"",resultArr:[],resultList:[]}},props:["gisInfo"],watch:{gisInfo:{immediate:!0,deep:!0,handler:function(e){console.log("----------------------"),console.log(e),this.longitude=e.longitude,this.latitude=e.latitude,this.layerID=e.layerID,this.handInitMap(),this.$forceUpdate()}},search_addr:{deep:!0,handler:function(e,t){this.resultArr=[];for(var a=this.resultList.length,i=[],r=0;r<a;r++)this.resultList[r].value.indexOf(this.search_addr)>=0&&i.push({value:this.resultList[r].value,id:this.resultList[r].id,longitude:this.resultList[r].longitude,latitude:this.resultList[r].latitude});this.resultArr=i}}},methods:{handPoint:function(){var e=this;l["a"].add_point(this.map,999,999,null,"").then((function(t){e.$emit("marked",t[0],t[1])}))},searchMap:function(){var e=this;if(l["a"].delete_draw(this.map,"search"),l["a"].delete_draw(this.map,"center"),""!=this.search_addr){var t=0,a=0;l["a"].local_search(this.map.getLayers().getArray()[0],this.search_addr,!1).then((function(i){if(i.length>0){var r=i[0].location,o=r.split(","),n=l["a"].gaode_gcs(o);n&&2==n.length&&(t=n[0],a=n[1],l["a"].center_display(parseFloat(t),parseFloat(a),200,e.map))}}))}},loadSearchResult:function(){var e=this;this.resultList=[],this.resultArr=[],l["a"].local_search(this.map.getLayers().getArray()[0],this.search_addr,!1).then((function(t){if(t.length>0)for(var a=0;a<t.length;a++){var i=t[a].location,r=i.split(","),n=l["a"].gaode_gcs(r),s=0,d=0;n&&2==n.length&&(s=n[0],d=n[1]),e.resultList.push({value:t[a].name+"("+t[a].address+")",id:t[a].id,longitude:s,latitude:d})}var c,u=Object(o["a"])(e.resultList);try{for(u.s();!(c=u.n()).done;){var h=c.value;e.resultArr.push({value:h.value,id:h.id,longitude:h.longitude,latitude:h.latitude})}}catch(p){u.e(p)}finally{u.f()}}))},querySearchAsync:function(e,t){var a=this.resultArr;t(a)},handleAddrSelect:function(e){l["a"].center_display(parseFloat(e.longitude),parseFloat(e.latitude),200,this.map)},handInitMap:function(){var e=this;setTimeout((function(){void 0!=e.$refs.map&&(void 0==e.map?(console.log("created"),e.map=l["a"].set_map("commonMap",!1,!1,!1,!1,!1),l["a"].add_baselayers(e.map),l["a"].set_layers(e.map).then((function(t){l["a"].add_one_layer_featurelist(e.map,parseInt(e.layerID),[]),l["a"].open_levels(!1,e.map),e.longitude>0?l["a"].center_display(e.longitude,e.latitude,50,e.map):l["a"].center_display(113.07329268615261,28.255592768842703,500,e.map)}))):(console.log("created1"),l["a"].delete_layer_features(e.map,[]),l["a"].cancel_draw(e.map,"get_extent"),l["a"].cancel_draw(e.map,"add_feature"),l["a"].delete_draw(e.map,"range"),l["a"].delete_draw(e.map,"center"),l["a"].set_layers(e.map).then((function(t){l["a"].add_one_layer_featurelist(e.map,parseInt(e.layerID),[]),l["a"].open_levels(!1,e.map),e.longitude>0?(l["a"].center_display(e.longitude,e.latitude,500,e.map),l["a"].delete_draw(e.map,"center")):l["a"].center_display(113.07329268615261,28.255592768842703,500,e.map)}))))}),500)}},mounted:function(){}},s=n,d=(a("b205"),a("2877")),c=Object(d["a"])(s,i,r,!1,null,"6cd33be4",null);t["a"]=c.exports}}]);